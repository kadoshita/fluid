version: '3'

services:
    db:
        image: mongo:6.0.5
        restart: always
        ports:
            - 27017:27017
        volumes:
            - ./mongo:/data/db
        environment:
            MONGO_INITDB_ROOT_USERNAME: fluid
            MONGO_INITDB_ROOT_PASSWORD: fluid
            MONGO_INITDB_DATABASE: fluid

    app:
        image: node:18.15.0-bullseye-slim
        restart: always
        tty: true
        volumes:
            - .:/usr/local/src/
        ports:
            - 3000:3000
        depends_on:
            - db
        healthcheck:
            test:
                [
                    'CMD',
                    'curl',
                    '-f',
                    '-s',
                    '-S',
                    '-o',
                    '/dev/null',
                    'http://localhost:3000/api/health',
                    '||',
                    'exit',
                    '1',
                ]
            timeout: 20s
            retries: 50
        env_file: ./.env.development.local
